<!DOCTYPE html>
<html lang="ru" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Устанавливаем youtrack 5.x в бесплатном облаке openshift. - /var/log</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="google-site-verification" content="ChlPwG-TdkqtdnbP61Lo2p00ADRgsLsw-ILxFokh8Ck" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://danilkuznetsov.github.io/install-youtrack-5x-into-free-cloud-openshift.html">

        <meta name="author" content="danil.kuznetsov" />
        <meta name="keywords" content="cloud,nix,openshift,youtrack" />
        <meta name="description" content="Запуск youtrack будем производить в Standalone (используя встроенный jetty) режиме. Требования yourtrack: To run YouTrack Standalone via JAR distribution file, you need to have Java JDK 1.5 and higher.* YouTrack requires at least 512Mb of JVM heap memory. You can set the size of heap memory via -Xmx parameter …" />

        <meta property="og:site_name" content="/var/log" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Устанавливаем youtrack 5.x в бесплатном облаке openshift."/>
        <meta property="og:url" content="https://danilkuznetsov.github.io/install-youtrack-5x-into-free-cloud-openshift.html"/>
        <meta property="og:description" content="Запуск youtrack будем производить в Standalone (используя встроенный jetty) режиме. Требования yourtrack: To run YouTrack Standalone via JAR distribution file, you need to have Java JDK 1.5 and higher.* YouTrack requires at least 512Mb of JVM heap memory. You can set the size of heap memory via -Xmx parameter …"/>
        <meta property="article:published_time" content="2016-06-01" />
            <meta property="article:section" content="java" />
            <meta property="article:tag" content="cloud" />
            <meta property="article:tag" content="nix" />
            <meta property="article:tag" content="openshift" />
            <meta property="article:tag" content="youtrack" />
            <meta property="article:author" content="danil.kuznetsov" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://danilkuznetsov.github.io/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://danilkuznetsov.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://danilkuznetsov.github.io/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://danilkuznetsov.github.io/theme/css/style.css" type="text/css"/>

        <link href="https://danilkuznetsov.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="/var/log ATOM Feed"/>

        <link href="https://danilkuznetsov.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="/var/log RSS Feed"/>


        <link href="https://danilkuznetsov.github.io/feeds/java.atom.xml" type="application/atom+xml" rel="alternate"
              title="/var/log java ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://danilkuznetsov.github.io/" class="navbar-brand">
/var/log            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/links.html">Links</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://danilkuznetsov.github.io/install-youtrack-5x-into-free-cloud-openshift.html"
                       rel="bookmark"
                       title="Permalink to Устанавливаем youtrack 5.x в бесплатном облаке openshift.">
                        Устанавливаем youtrack 5.x в бесплатном облаке openshift.
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-06-01T06:42:00+03:00"> Wed 01 June 2016</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://danilkuznetsov.github.io/tag/cloud/">cloud</a>
        /
	<a href="https://danilkuznetsov.github.io/tag/nix/">nix</a>
        /
	<a href="https://danilkuznetsov.github.io/tag/openshift/">openshift</a>
        /
	<a href="https://danilkuznetsov.github.io/tag/youtrack/">youtrack</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><strong>Запуск youtrack будем производить в Standalone (используя встроенный jetty) режиме.</strong></p>
<h4>Требования yourtrack:</h4>
<ul>
<li>To run YouTrack Standalone via JAR distribution file, you need to have
Java JDK 1.5 and higher.*</li>
<li>YouTrack requires at least 512Mb of JVM heap memory. You can set the
size of heap memory via -Xmx parameter when starting youtrack-xx.jar
from the command line.<br>
Otherwise, set the system default JVM heap size. As the YouTrack
database grows you should increase the JVM memory size.<br>
In order to open graphic attachments and render image thumbnails
correctly, it is required to use Java in Headless Mode. To enable Java
Headless Mode, you can use -Djava.awt.headless=true parameter in the
command line, when starting YouTrack, or set java.awt.headless system
property. For more information about Java Headless Mode please refer to
the<a href="http://java.sun.com/developer/technicalArticles/J2SE/Desktop/headless/">Using Headless Mode in the Java SE
Platform</a>
article on Java official web-site.*</li>
</ul>
<h4>Ограничения виртуальной среды openshift:</h4>
<ul>
<li>Доступ к файлам и папкам.</li>
<li>Для записи и хранения пользовательских данных предусмотена папка</li>
<li>app-root/data. Путь береться из переменной OPENSHIFT_DATA_DIR.</li>
<li>Доступ к сети.</li>
<li>Доступный ip адрес и порт содержится в переменных :<ul>
<li>OPENSHIFT_DIY_IP</li>
<li>OPENSHIFT_DIY_PORT</li>
</ul>
</li>
</ul>
<p>Youtrack создает в домашней каталоге пользователя свои директории для БД
и для backup БД. При запуске Jetty создает свои файлы и папки в домашнем
каталоге пользователя. Для jetty так же необходимо указать порт и адрес
который будет прослушиваться для входящих подключений.</p>
<h4>Переменные среды которые нам понадобятся:</h4>
<p><code>OPENSHIFT\_DATA\_DIR</code> - данные нашел приложения, на нее есть права на запись, и она не перезаписіваеться при редеплое.<br>
<code>OPENSHIFT\_REPO\_DIR</code> - папка с репозиторием приложения.</p>
<p><code>OPENSHIFT\_DIY\_IP</code> - ip адрес виртуальной машины.
<code>OPENSHIFT\_DIY\_PORT</code> - порт адрес виртуальной машины.</p>
<h4>Исходя из всех особенностей строка для запуска имеет вид:</h4>
<div class="highlight"><pre><span></span>nohup /usr/lib/jvm/java-1.7.0/bin/java
-Xmx512m 
-Djetty.home=<span class="nv">$OPENSHIFT_DATA_DIR</span>
-Ddatabase.location=<span class="cp">${</span><span class="n">OPENSHIFT_DATA_DIR</span><span class="cp">}</span>teamsysdata
-Ddatabase.backup.location=<span class="cp">${</span><span class="n">OPENSHIFT_DATA_DIR</span><span class="cp">}</span>teamsysdata-backup
-Djava.awt.headless=true -jar <span class="cp">${</span><span class="n">OPENSHIFT_REPO_DIR</span><span class="cp">}</span>diy/youtrack.jar
<span class="cp">${</span><span class="n">OPENSHIFT_DIY_PORT</span><span class="cp">}</span> <span class="err">&amp;</span>
</pre></div>


<h4 id="установка-и-настройка" style="text-align: left;">Установка и настройка</h4>
<ol>
<li>Создадим application с типом diy.</li>
<li>Склонируем репозиторий с application на локальную машину.</li>
<li>Скачаем jar файл последней версию youtrack (Необходимо смотреть на
    требования для памяти, последняя версия подходящая для openshift по
    требованиям памяти = youtrack 5.2.5).</li>
<li>Изменяем <code>.openshift/action\_hooks/start.</code></li>
<li>Запуск приложения производится следующей командой: 
    <code>nohup /usr/lib/jvm/java-1.7.0/bin/java 
    -Xmx512m
    -Djetty.home=$OPENSHIFT_DATA_DIR  
    -Ddatabase.location=${OPENSHIFT_DATA_DIR}teamsysdata
    -Ddatabase.backup.location=${OPENSHIFT_DATA_DIR}teamsysdata-backup
    -Djava.awt.headless=true -jar ${OPENSHIFT_REPO_DIR}diy/youtrack.jar ${OPENSHIFT_DIY_PORT} &amp;</code>    </li>
<li>Изменяем <code>.openshift/action_hooks/stop.</code></li>
<li>Остановка приложения производится следующей командами:
   <code>APP_PID=`ps aux | grep -v grep | grep java | awk '{print $2}'`
   kill -9 $APP_PID &gt; /dev/null 2&gt;&amp;1
   exit 0</code></li>
<li>Удаляем все содержимое папки diy и копируем туда скачанный файл
    переименовав его в youtrack.jar.</li>
<li>После чего фиксируем изменения в репозитории</li>
<li><code>git add .</code></li>
<li><code>git commit -m"Deploy YouTrack"</code></li>
<li><code>git push</code></li>
<li>После окончания запуска jetty переходим по ссылке, которую указывали при создании application и заканчиваем установку через web.</li>
</ol>
<p>Размер youtrack.jar - 55 мб</p>
<p>При большом кол-ве коммитов с jar файлом могут возникнуть проблемы с
местом на диске. Т.к. репозиторий храниться в дисковом пространстве
пользователя, для этого не обходимо проверсти очистку репозитория.</p>
<p>Синхронизации с другим сервером для копированием бекапов БД, прежде их
нужно настроить в gui youtrack:</p>
<p><code>rsync -avz --delete &lt;your openshit node&gt;:app-root/data/teamsysdata-backup/&lt;path to backup&gt;</code></p>
<h4>Официальная документация</h4>
<p><a href="https://confluence.jetbrains.com/display/YTD5/YouTrack+Documentation">Документация youtrack 5.x</a></p>
<p><a href="https://docs.openshift.org/latest/welcome/index.html">Документация openshift</a></p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="http://github.com/danilkuznetsov"><i class="fa fa-github-square fa-lg"></i> github</a></li>
              </ul>
            </li>





    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Danil Kuznetsov
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://danilkuznetsov.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://danilkuznetsov.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://danilkuznetsov.github.io/theme/js/respond.min.js"></script>

    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-63832974-2']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>